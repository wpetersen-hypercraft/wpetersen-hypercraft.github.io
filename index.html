<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypercraft Configuration Fileserver - Demo</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .folder { cursor: pointer; }
    </style>
</head>
<body>
    <h1>Hypercraft Configuration Fileserver - Demo</h1>
    <p>This is a demo for Hypercraft's Git-based configuration fileserver.</p>
    <h2>File Explorer</h2>
    <table id="file-explorer">
        <thead>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Size</th>
            </tr>
        </thead>
        <tbody id="file-list"></tbody>
    </table>

    <script>
        // Function to format the date
        function formatDate(dateString) {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) {
            return "N/A";
            }
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }
        
        // Function to format file size
        function formatSize(sizeInBytes) {
            if (sizeInBytes < 1024) {
            return sizeInBytes + ' B';
            } else if (sizeInBytes < 1024 * 1024) {
            return (sizeInBytes / 1024).toFixed(2) + ' KB';
            } else {
            return (sizeInBytes / (1024 * 1024)).toFixed(2) + ' MB';
            }
        }
        
        // Function to load and display files
        function loadFiles() {
            const owner = 'wpetersen-hypercraft';
            const repo = 'wpetersen-hypercraft.github.io';
            const path = 'contents'; // Focusing on the 'contents' folder
        
            fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`)
            .then(response => response.json())
            .then(data => {
                const fileList = document.getElementById('file-list');
                fileList.innerHTML = ''; // Clear existing content
        
                data.forEach(item => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                const link = document.createElement('a');
                link.href = item.download_url;
                link.textContent = item.name;
                nameCell.appendChild(link);
                
                const dateCell = document.createElement('td');
                dateCell.textContent = 'Loading...';
                
                const sizeCell = document.createElement('td');
                sizeCell.textContent = formatSize(item.size);
                
                row.appendChild(nameCell);
                row.appendChild(dateCell);
                row.appendChild(sizeCell);
                
                fileList.appendChild(row);
        
                // Fetch last modified date for each file
                fetchLastModifiedDate(owner, repo, item.path)
                    .then(date => {
                    dateCell.textContent = formatDate(date);
                    })
                    .catch(() => {
                    dateCell.textContent = 'N/A';
                    });
                });
            })
            .catch(error => console.error('Error:', error));
        }
        
        // Function to fetch the last modified date for a specific file
        function fetchLastModifiedDate(owner, repo, path) {
            return fetch(`https://api.github.com/repos/${owner}/${repo}/commits?path=${path}&page=1&per_page=1`)
            .then(response => response.json())
            .then(commits => {
                if (commits.length > 0) {
                return commits[0].commit.committer.date;
                }
                throw new Error('No commit information found');
            });
        }
        
        // Call loadFiles when the page loads
        window.onload = loadFiles;
    </script>
</body>
</html>