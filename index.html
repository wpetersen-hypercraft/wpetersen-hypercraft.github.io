<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypercraft Configuration Fileserver - Demo</title>
</head>
<body>
    <h1>Hypercraft Configuration Fileserver - Demo</h1>
    <p>This is a demo for Hypercraft's Git-based configuration fileserver.</p>
    <div id="breadcrumb"></div>
    <h2>File Explorer</h2>
    <table id="file-explorer">
        <thead>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Size</th>
            </tr>
        </thead>
        <tbody id="file-list"></tbody>
    </table>

    <script>
        const fileList = document.getElementById('file-list');
        const breadcrumb = document.getElementById('breadcrumb');
        const apiBase = 'https://api.github.com/repos/wpetersen-hypercraft/wpetersen-hypercraft.github.io/contents/';
        const rootPath = 'contents';

        function getPathFromUrl() {
            let path = window.location.pathname.split('/').filter(Boolean);
            if (path[0] !== rootPath) {
                path.unshift(rootPath);
            }
            return path.join('/');
        }

        function fetchFiles(path) {
            fetch(`${apiBase}${path}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => renderFiles(data))
                .catch(error => console.error('Error fetching files:', error));
        }

        function renderFiles(files) {
            fileList.innerHTML = '';
            files.forEach(file => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="${file.type === 'dir' ? 'folder' : ''}" data-path="${file.path}">${file.name}</td>
                    <td>${new Date(file.date).toLocaleString()}</td>
                    <td>${file.size ? file.size : '-'}</td>
                `;
                fileList.appendChild(row);
            });

            document.querySelectorAll('.folder').forEach(folder => {
                folder.addEventListener('click', (event) => {
                    const path = event.target.getAttribute('data-path');
                    window.history.pushState({}, '', `/${path}`);
                    updateBreadcrumb(path);
                    fetchFiles(path);
                });
            });
        }

        function updateBreadcrumb(path) {
            const parts = path.split('/');
            breadcrumb.innerHTML = parts.map((part, index) => {
                const href = '/' + parts.slice(0, index + 1).join('/');
                return `<a href="${href}">${part}</a>`;
            }).join(' / ');

            document.querySelectorAll('#breadcrumb a').forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const path = event.target.getAttribute('href').substring(1);
                    window.history.pushState({}, '', `/${path}`);
                    fetchFiles(path);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const path = getPathFromUrl();
            updateBreadcrumb(path);
            fetchFiles(path);
        });

        window.addEventListener('popstate', () => {
            const path = getPathFromUrl();
            updateBreadcrumb(path);
            fetchFiles(path);
        });
    </script>
</body>
</html>